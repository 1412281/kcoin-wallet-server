var axios = require('axios');

exports.createTransaction = function () {

    var referenceOutputs = [
        {hash: '6d97526dc919784ffabefd21adfffe56ab2384e43e41b085a54f5fd39ee6654c', index: 5, value: 10000}
    ];

// Read key (address, public key, private key)
    var key = {
        "privateKey": "2d2d2d2d2d424547494e205253412050524956415445204b45592d2d2d2d2d0a4d4949435777494241414b42675143306f6a454a545148487934377666314931424b50637737483464334b6c34445842767233505a624c63552b5a4c793941620a5a54594e6c79456d473749674373556d59314b4b67336635304478495863517232447a4a7753476b696f466e395a6a5361326e505a66627a69363545427650350a2f526570366f5653734c646f3133484e4e6a77383862454a7a717946326a4f33503136767144505a472f53443162476d474b364a3063464572774944415141420a416f47414b71436b4264666764612f364756626f7059356b78544b42693274553651525361316943487247585668754f6d35434c6d67743269427145506951480a457a793362656d2b6a755762714a36567531593164307465664c4366736f52796e4f4e645a7a5749732f3747664a6764397946514c383975587a62464576682f0a4c52324447773459324a5745774a6c4c594c752b7374484b754a6968333975784557426e632b364b63386642647645435151446b346c664b4b6a507550764b420a4f50462b724c6171694f4972306372537a4354362b58624e33746d317a353448692b6f326565674d44345a3035655a426a5859354e503634716d5270585233720a334f585863566c39416b45417967682b43735a59364730683242333477706f51614e336a5838764c6870385a4d593138514e5148754a614f47335462424a36750a6c6d73736f616e664a766c6f515375725150484941483576364d677a5351784f6d774a41577a4f646935375a5a6e754b6f64635130307236316d5549796a456b0a516d363535593931755836732f58636e4878617655746d736a764734762b66446f69632b446e6d4262672f6e5274796c795a4152765a45612b514a415a6b71530a647159696b6476666a4f72763771664f73796e56573856316b5032773564503747312b2f5951687066794656577974307668675a69756a565959685a3774564c0a616943413453386a506a74504c43636444514a41627834334e5233323872374e5675437973726e6b474e497253784e335a696c353075543973376e356d3373510a55496b6a716b69795376634942736564484274416d72334c776e384d53492f786e34636545394f6876513d3d0a2d2d2d2d2d454e44205253412050524956415445204b45592d2d2d2d2d0a",
        "publicKey": "2d2d2d2d2d424547494e205055424c4943204b45592d2d2d2d2d0a4d4947664d413047435371475349623344514542415155414134474e4144434269514b42675143306f6a454a545148487934377666314931424b5063773748340a64334b6c34445842767233505a624c63552b5a4c793941625a54594e6c79456d473749674373556d59314b4b67336635304478495863517232447a4a7753476b0a696f466e395a6a5361326e505a66627a69363545427650352f526570366f5653734c646f3133484e4e6a77383862454a7a717946326a4f33503136767144505a0a472f53443162476d474b364a3063464572774944415141420a2d2d2d2d2d454e44205055424c4943204b45592d2d2d2d2d0a",
        "address": "da0214e8d3317edfc1aa6df914d4c14bfd17cc55a10f74ea4b17124006991335"
    };

// Read destination address
    var destinations = [
        {address: '4edbd2d5a816a52f76a22e554ee0407e969f7c7374e6b3876d1a7aa06609b161', value: 1}
    ];


    var cost = 0;
    destinations.forEach(function (des) {
        cost += des.value;
    });

    var fund = 0;
    referenceOutputs.forEach(function (referenceOutput) {
        fund += referenceOutput.value;
    });

    var change = fund - cost;

// Generate transacitons
    var bountyTransaction = {
        version: 1,
        inputs: [],
        outputs: []
    };

    var keys = [];
    referenceOutputs.forEach(function (referenceOutput) {
        bountyTransaction.inputs.push({
            referencedOutput: referenceOutput.hash,
            referencedOutputIndex: referenceOutput.index,
            unlockScript: ''
        });
        keys.push(key);
    });

// Change because reference output must be use all value
    bountyTransaction.outputs.push({
        value: change,
        lockScript: 'ADD ' + key.address
    });

// Output to all destination 10000 each
    destinations.forEach(function (des) {
        bountyTransaction.outputs.push({
            value: des.value,
            lockScript: 'ADD ' + des.address
        });
    });

// Sign
axios.post('https://utils-kcoin.herokuapp.com/hash/sign', {
    params: {
        message:bountyTransaction,
        privateKeyHex: keys
    }
}).then(function (response) {
    console.log(response);
}).catch(function (err) {
    console.log(err);
});

// transactions.sign(bountyTransaction, keys);

// Write to file then POST https://api.kcoin.club/transactions
    console.log(JSON.stringify(bountyTransaction));

// => Hash: 6d97526dc919784ffabefd21adfffe56ab2384e43e41b085a54f5fd39ee6654c
}